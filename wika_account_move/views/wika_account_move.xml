<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <data>
    <record id="view_wika_account_move" model="ir.ui.view">
            <field name="name">wika.account.move.view.form</field>
            <field name="model">account.move</field>
            <field name="priority" eval="1"/>
            <field name="arch" type="xml">
            <form string="Invoice Form">
                <header>
                    <button name="action_print_invoice" string="Print" type="object" class="oe_highlight"
                        attrs="{'invisible': [('is_approval_checked', '=', False)]}"/>                
                    <button name="action_submit" string="SUBMIT" type="object" class="oe_highlight"
                        states="draft,rejected"/>
                    <button name="action_approve" string="APPROVE" type="object" class="btn-success"
                        states="uploaded"/>
                    <button name="action_reject" string="REJECT" type="object" class="btn-danger"
                        states="uploaded"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,uploaded,approved"/>
                </header>
                <sheet>
                    <div name="button_box" position="inside">
                       <button class="oe_stat_button" type="object" name="get_documents" icon="fa-file-text-o">
                            <field string="Documents" name="documents_count" widget="statinfo"/>
                        </button>
                    </div>
                    <div class="oe_title">
                        <h1>
                            <field name="name" attrs="{'invisible':[('name', '=', '/')],
                            'readonly': [('state', '!=', 'draft')]}" placeholder="Draft"/>
                        </h1>
                    </div>
                    <group>
                      <group id="header_left_group">
                           <field name="partner_id" widget="res_partner_many2one" string="Vendor" />
                            <field name="bap_id" domain="[('is_fully_invoiced', '=', False), ('state', 'in', ['draft','uploaded','approved'])]" attrs="{'readonly': [('state', 'in', ['uploaded', 'approved'])]}"/>
                           <field name="po_id" />
                           <field name="no_invoice_vendor" />
                           <field name="valuation_class" groups="base.group_no_one"/>
                           <field name="amount_invoice" />
                           <field name="no_faktur_pajak" />
                      </group>
                      <group id="header_right_group">
                            <field name="branch_id" domain="[('biro', '=', False)]"
                                    attrs="{'readonly': [('state', 'in', ['uploaded', 'approved'])]}"/>
                             <field name="check_biro" invisible="1"/>
                            <field name="department_id" domain="[('biro', '=', True), ('parent_id', '=', branch_id)]"
                                attrs="{'readonly': [('state', 'in', ['uploaded', 'approved'])], 'invisible': [('check_biro', '=', False)]}"/>
                            <field name="project_id" attrs="{'readonly': [('state', 'in', ['upload', 'approved'])]}"/>
                           <field name="step_approve" invisible="1"/>
                           <field name="invoice_date" string="Document Date"/>
                           <field name="date" string="Posting Date"/>
                          <field name="invoice_payment_term_id"/>
                          <field name="invoice_date_due"/>
                          <field name="baseline_date"/>
                         <field name="move_type" invisible="1"/>
                          <field name="company_id" invisible="1"/>
                            <field name="payment_state" invisible="1"/>
                            <field name="is_approval_checked" />

                      </group>
                    </group>
                    <notebook>
                            <page id="invoice_tab"
                                  name="invoice_tab"
                                  string="Invoice Lines"
                                  attrs="{'invisible': [('move_type', '=', 'entry')]}">
                                <field name="invoice_line_ids"
                                       widget="section_and_note_one2many"
                                       >
                                    <tree editable="bottom" create="0" delete="0" string="Journal Items" default_order="sequence, id">
                                        <control>
                                            <create name="add_line_control" string="Add a line"/>
                                            <create name="add_section_control" string="Add a section" context="{'default_display_type': 'line_section'}"/>
                                            <create name="add_note_control" string="Add a note" context="{'default_display_type': 'line_note'}"/>
                                        </control>

                                        <!-- Displayed fields -->
                                        <field name="sequence" widget="handle"/>
                                        <field name="product_id"
                                               optional="show" readonly="1" force_save="1"
                                               />
                                        <field name="name" string="Item Text"/>
                                        <field name="quantity" readonly="1" force_save="1"/>
                                        <field name="product_uom_category_id" invisible="1"/>
                                        <field name="product_uom_id" string="UoM" groups="uom.group_uom" readonly="1" force_save="1"/>
                                        <field name="price_unit" string="Price" readonly="1" force_save="1"/>
                                        <field name="discount" string="Disc.%" optional="hide"/>
                                        <field name="tax_ids" widget="many2many_tags"
                                               optional="show" readonly="1" force_save="1"/>
                                        <field name="price_subtotal"
                                               string="Subtotal"
                                               groups="account.group_show_line_subtotals_tax_excluded"/>
                                        <field name="price_total"
                                               string="Total"
                                               groups="account.group_show_line_subtotals_tax_included"/>
                                        <field name="bap_line_id" invisible="1"/>

                                        <!-- Others fields -->
                                        <field name="partner_id" invisible="1"/>
                                        <field name="currency_id" invisible="1"/>
                                        <field name="company_id" invisible="1"/>
                                        <field name="company_currency_id" invisible="1"/>
                                        <field name="display_type" force_save="1" invisible="1"/>
                                        <!-- /l10n_in_edi.test_edi_json -->
                                        <!-- required for @api.onchange('product_id') -->
                                    </tree>
                                </field>
                                <group col="12" class="oe_invoice_lines_tab">
                                    <group colspan="8">
                                        <field name="narration" placeholder="Terms and Conditions" colspan="2" nolabel="1"/>
                                    </group>
                                    <!-- Totals (only invoices / receipts) -->
                                    <group colspan="4">
                                        <group class="oe_subtotal_footer oe_right">
<!--
                                                <field name="amount_untaxed"/>
                                                <field name="amount_tax" string="Total PPN"/>
-->

                                            <field name="tax_totals"  widget="account-tax-totals-field" nolabel="1" colspan="2"/>
                                            <field name="total_pph"/>
                                             <field name="amount_total_footer" string="Total Without PPN"/>
                                            <field name="amount_total_payment" string="Total With PPN"/>
                                            <field name="invoice_payments_widget" invisible="1" colspan="2" nolabel="1" widget="payment"/>
                                            <field name="amount_residual" invisible="1" class="oe_subtotal_footer_separator" attrs="{'invisible': [('state', '=', 'draft')]}"/>

                                        </group>
<!--                                        <group class="oe_subtotal_footer oe_right"
                                            attrs="{'invisible': ['|', ('move_type', 'not in', ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt')),
                                                                       ('payment_state' ,'=', 'invoicing_legacy')]}">

                                            <field name="tax_totals" widget="account-tax-totals-field" nolabel="1" colspan="2"/>

                                            <field name="invoice_payments_widget" colspan="2" nolabel="1" widget="payment"/>
                                            <field name="amount_residual" class="oe_subtotal_footer_separator" attrs="{'invisible': [('state', '=', 'draft')]}"/>
                                        </group>-->
                                        <field name="invoice_outstanding_credits_debits_widget"
                                            class="oe_invoice_outstanding_credits_debits"
                                            colspan="2" nolabel="1" widget="payment"
                                            attrs="{'invisible': ['|', ('state', '!=', 'posted'), ('move_type', 'in', ('out_receipt', 'in_receipt'))]}"/>
                                    </group>
                                </group>
                            </page>
                          <page id="other_tab" string="Other Info" name="other_info">

                            <group id="other_tab_group">
                                 <field name="payment_reference"/>
                                <field name="pr_id" invisible="1"/>
                                <field name="invoice_number" readonly="1" attrs="{'invisible': [('state', '!=', 'approved')]}"/>
                                <field name="partner_bank_id" string="Bank Account"/>
                                <field name="account_id"/>
                                <field name="retention_due"/>
                                 <field name="amount_total_footer" groups="base.group_no_one"/>
                                                        <field name="total_line" groups="base.group_no_one"/>

                            </group>
                          </page>
                        <page string="List Document">
                        <field name="document_ids" attrs="{'readonly': [('state', 'not in', ['draft','rejected'])]}">
                            <tree create="0" delete="0">
                                <field name="document_id"/>
                                <field name="document" attrs="{'readonly': [('state', 'not in', ['waiting','rejected'])]}" widget="binary_button" filename="filename"/>
                                <field name="filename" invisible="1"/>
                                <field name="state"/>
                            </tree>
                            <form>
                                <group>
                                    <field name="document" attrs="{'readonly': [('state', 'not in', ['waiting','rejected'])]}" widget="pdf_viewer" filename="filename"/>
                                    <field name="filename" invisible="1"/>
                                    <field name="state" invisible="1"/>
                                </group>
                            </form>
                        </field>
                    </page>
                    <page string="Potongan Lain-lain dan PPH">
                        <group string="List PPH">
                            <field name="pph_ids" domain="[('tax_group_id', '!=', 'PPN')]"/>
                        </group>
                        <group string="Total PPH">
                            <div>
                                <field name="total_pph"/> 
                            </div>
                        </group>
                        <group string="Potongan Lain Lain">
                         <field name="price_cut_ids" nolable="1" attrs="{'readonly': [('state', 'in', ('uploaded', 'approved'))]}">
                            <tree editable="top">
                                <field name="move_id" invisible="1"/>
                                <field name="product_id"/>
                                 <field name="special_gl_id"/>
                                <field name="account_id"/>
                                <field name="percentage_amount"/>
                                <field name="amount"/>
                            </tree>
                        </field>
                        </group>
                        <group string="Total Potongan">

                            <field name="dp_total"/>
                            <field name="retensi_total"/>

                        </group>
                    </page>
                    <page string="List Approval">
                        <group>
                            <field name="history_approval_ids" readonly="1" force_save="1">
                                <tree string="List Approval">
                                    <field name="user_id"/>
                                    <field name="groups_id"/>
                                    <field name="date"/>
                                    <field name="note"/>
                                    <field name="information" widget="html"/>
                                    <field name="is_show_wizard" readonly="0"/>
                                </tree>
                                <form>
                                    <group>
                                        <field name="user_id"/>
                                        <field name="groups_id"/>
                                        <field name="date"/>
                                        <field name="note"/>
                                        <field name="information" widget="html"/>
                                        <field name="is_show_wizard" readonly="0"/>
                                    </group>
                                </form>
                            </field>
                        </group>
                    </page>
                    </notebook>
                </sheet>
            </form>
            </field>
    </record>

        <!-- tree -->
        <record id="view_wika_account_move_tree_inherited" model="ir.ui.view">
            <field name="name">wika.account.move.inherit.view.tree</field>
            <field name="model">account.move</field>
            <field name="priority" eval="1"/>
            <field name="inherit_id" ref="account.view_in_invoice_bill_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='name']" position="after">
                    <field name="branch_id"/>
                    <field name="department_id"/>
                    <field name="project_id"/>
                    <field name="partner_id"/>
                    <field name="invoice_date"/>
                    <!-- <field name="amount_total_signed"/> -->
                </xpath>
                
                <!-- hide tree field -->
                <xpath expr="field[@name='invoice_partner_display_name']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                 <xpath expr="//field[@name='amount_total_signed']" position="before">
                    <field name="amount_untaxed"/>
                     <field name="amount_tax" string="Total PPN"/>
                     <field name="total_pph" string="Total PPH"/>
                     <field name="amount_total_payment"/>
                 </xpath>
                 <xpath expr="field[@name='amount_total_signed']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                 <xpath expr="field[@name='amount_total_in_currency_signed']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="field[@name='invoice_date_due']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="field[@name='ref']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="field[@name='activity_ids']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="field[@name='invoice_date']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="field[@name='amount_untaxed_signed']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="field[@name='date']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="field[@name='invoice_origin']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="field[@name='payment_reference']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="field[@name='company_id']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="field[@name='amount_residual_signed']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <!--<xpath expr="field[@name='amount_total']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>-->

                <xpath expr="field[@name='currency_id']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="field[@name='to_check']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="field[@name='amount_tax_signed']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
            </field>
        </record>


    </data>
    
</odoo>
